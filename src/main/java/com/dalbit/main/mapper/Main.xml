<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.main.dao.MainDao" >

    <select id="callMainFanRanking" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MainFanRankingVo">
        call sp_ranking_fan(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMainDjRanking" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MainDjRankingVo">
        call sp_ranking_dj(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMainMyDjList" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MainMyDjVo">
        call sp_broadcast_room_list_mydj(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMainRecommandList" parameterType="String" resultType="P_MainRecommandVo">
        SELECT
            T1.mem_no AS memNo
            , T1.mem_nick AS nickNm
            , T1.mem_sex AS gender
            , T2.image_profile AS profileUrl
            , T3.room_no AS roomNo
            , T3.subject_type AS roomType
            , T3.title as title
            , IFNULL(T3.count_entry, 0) as listeners
            , IFNULL(T3.count_good, 0) as likes
            , T2.image_background as bannerUrl
        FROM tb_member_basic T1 INNER JOIN tb_member_profile T2 ON T1.mem_no = T2.mem_no
        LEFT OUTER JOIN tb_broadcast_room T3 ON T1.mem_no = T3.mem_no AND T3.state <![CDATA[<]]> 4
        LEFT OUTER JOIN tb_broadcast_room_member T4 ON T3.room_no = T4.room_no AND T3.mem_no = T4.mem_no AND T4.auth = 3 AND T4.state = 0
        WHERE T1.mem_no IN (${value})
          AND T1.mem_state = 1
        ORDER BY T3.room_no DESC, RAND(1)
    </select>


    <select id="callMainStarList" parameterType="String" resultType="P_MainStarVo">
        SELECT
            T1.mem_no_star AS memNo
            , T2.mem_nick AS nickNm
            , T2.mem_sex AS gender
            , T3.image_profile AS profImgUrl
            , T4.room_no AS roomNo
            , T4.title AS title
            , T4.subject_type AS roomType
            , T4.code AS roomTypeNm
        FROM tb_member_fanstar T1 INNER JOIN tb_member_basic T2 ON T1.mem_no_star = T2.mem_no
            INNER JOIN tb_member_profile T3 ON T1.mem_no_star = T3.mem_no
            LEFT OUTER JOIN (
                SELECT
                S1.room_no
                , S1.mem_no
                , S1.title
                , S1.subject_type
                , S3.code
                FROM tb_broadcast_room S1 INNER JOIN tb_broadcast_room_member S2 ON S1.mem_no = S2.mem_no AND S2.auth = 3 and S2.state = 0
                INNER JOIN tbl_code_define S3 ON S1.subject_type = S3.value AND S3.type = 'subject_type'
                WHERE S1.state &lt; 4
            ) T4 ON T1.mem_no_star = T4.mem_no
        WHERE T1.mem_no_fan = #{value}
        LIMIT 0, 10
    </select>

</mapper>