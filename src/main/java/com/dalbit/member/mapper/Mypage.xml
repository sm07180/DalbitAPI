<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.member.dao.MypageDao" >

    <select id="callProfileEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_profile_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callFanstarInsert" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_fanstar_insert(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callFanstarDelete" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_fanstar_delete(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberInfo" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_info_view(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callBroadBasic" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_basic_request(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callBroadBasicEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_basic_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberReportAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_report_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberBlockAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_block_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberBlockDel" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_block_delete(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberNotify" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_setting_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberNotifyEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_setting_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberShortCut" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MemberShortCutVo">
        call sp_member_broadcast_shortcut_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberShortCutEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_shortcut_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberGiftRuby" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_gift_ruby(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberNotification" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_NotificationVo">
        call sp_member_notification_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageNoticeAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_notice_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageNoticeEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_notice_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageNoticeDel" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_notice_delete(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageNoticeSelect" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MypageNoticeSelectVo">
        call sp_member_broadcast_notice_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberWalletDal" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_DalVo">
        call sp_member_wallet_dal(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMemberWalletByeol" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_ByeolVo">
        call sp_member_wallet_byeol(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageMypageReportBroad" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MypageReportBroadVo">
        call sp_member_broadcast_broadcasting_report(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageMypageReportListen" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MypageReportListenVo">
        call sp_member_broadcast_listening_report(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMyapgeGetBanWord" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_banword_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageInsertBanWord" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_banword_save(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageSearchUser" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_SearchUserVo">
      call sp_member_broadcast_search(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageManager" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MypageManagerVo">
      call sp_member_broadcast_manager_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageManagerAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_manager_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageManagerEdit" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_manager_edit(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageManagerDel" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_manager_delete(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageBlackListView" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_MypageBlackVo">
      call sp_member_broadcast_black_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageBlackListAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_black_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callMypageBlackListDel" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_broadcast_black_delete(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="changeItemSelect" statementType="CALLABLE" parameterType="ProcedureVo" resultType="P_ChangeItemListVo">
      call sp_member_change_item_select(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="changeItem" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_change_item(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="callReadNotification" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
      call sp_member_notification_read(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <update id="callReadALLNotification" parameterType="P_NotificationVo" >
        UPDATE tb_member_notification
			SET read_yn = 1
		WHERE mem_no = #{mem_no}
    </update>

    <select id="selectMyByeolCnt" parameterType="String" resultType="long">
        SELECT gold FROM tb_member_wallet WHERE mem_no = #{value}
    </select>

    <select id="selectExistsSpecialReq" parameterType="String" resultType="int">
        SELECT
          COUNT(*)
        FROM rd_admin.tb_req_special_dj
        WHERE mem_no = #{value}
          -- AND state = 1
          <!-- 스페셜 DJ는 매달 신청을 받는다. -->
          AND DATE_FORMAT(reg_date, '%Y%m') = DATE_FORMAT(now(), '%Y%m')
    </select>

    <select id="selectExistsPhoneSpecialReq" parameterType="String" resultType="int">
        SELECT
          COUNT(*)
        FROM rd_admin.tb_req_special_dj
        WHERE mem_phone = #{value}
          AND state = 1
          <!-- 스페셜 DJ는 매달 신청을 받는다. -->
          AND DATE_FORMAT(reg_date, '%Y%m') = DATE_FORMAT(now(), '%Y%m')
    </select>

    <insert id="insertSpecialReq" parameterType="P_SpecialDjReq">
        INSERT INTO rd_admin.tb_req_special_dj(
          mem_no
          , mem_name
          , mem_phone
          , title
          , contents
          , broadcast_time1
          , broadcast_time2
          , reg_date
          , state
        ) values (
          #{mem_no}
          , #{name}
          , #{phone}
          , #{title}
          , #{contents}
          , #{broadcast_time1}
          , #{broadcast_time2, jdbcType=VARCHAR}
          , NOW()
          , 1
        )
    </insert>

    <select id="selectLevel" resultType="LevelVo">
      SELECT
        `level`
        , grade
        , ruby AS dal
        , gold AS byeol
      FROM tbl_level_exp
      WHERE `level` > 0 ORDER BY `level` ASC
    </select>

    <select id="callNewAlarm" parameterType="com.dalbit.member.vo.procedure.P_MemberNotifyVo" resultType="int">
		SELECT COUNT(*) FROM tb_member_notification WHERE mem_no = #{mem_no} AND read_yn = '0'
    </select>

    <select id="selectSpecialDjBroadcastTime" parameterType="com.dalbit.member.vo.SpecialDjRegManageVo" resultType="long">
        /* Mypage.xml - selectSpecialDjBroadcastTime */
        select TRUNCATE(ifnull(sum(airtime), 0)/60, 0) airtime
        from rd_data.tb_broadcast_room
        where mem_no = #{mem_no}
            and DATE_FORMAT(concat(#{condition_start_date}, ' 00:00:00'), '%Y-%m-%d %H:%i:%s') <![CDATA[<=]]> start_date
            and start_date <![CDATA[<=]]> DATE_FORMAT(concat(#{condition_start_date}, ' 23:59:59'), '%Y-%m-%d %H:%i:%s')
    </select>

    <select id="selectSpecialDjLikeCnt" parameterType="com.dalbit.member.vo.SpecialDjRegManageVo" resultType="int">
        /* Mypage.xml - selectSpecialDjLikeCnt */
        select count(*)
        from rd_data.tb_broadcast_room_good
        where dj_mem_no = #{mem_no}
            and DATE_FORMAT(concat(#{condition_start_date}, ' 00:00:00'), '%Y-%m-%d %H:%i:%s') <![CDATA[<=]]> last_upd_date
            and last_upd_date <![CDATA[<=]]> DATE_FORMAT(concat(#{condition_start_date}, ' 23:59:59'), '%Y-%m-%d %H:%i:%s')
    </select>

    <select id="selectSpecialDjBroadcastCnt" parameterType="com.dalbit.member.vo.SpecialDjRegManageVo" resultType="int">
        /* Mypage.xml - selectSpecialDjBroadcastCnt */
        select count(*)
        from rd_data.tb_broadcast_room
        where mem_no = #{mem_no}
            and 3600 <![CDATA[<=]]> airtime
            and DATE_FORMAT(concat(#{condition_start_date}, ' 00:00:00'), '%Y-%m-%d %H:%i:%s') <![CDATA[<=]]> start_date
            and start_date <![CDATA[<=]]> DATE_FORMAT(concat(#{condition_start_date}, ' 23:59:59'), '%Y-%m-%d %H:%i:%s')
    </select>

    <select id="selectSpecialDjReqManage" parameterType="com.dalbit.member.vo.SpecialDjRegManageVo" resultType="com.dalbit.member.vo.SpecialDjRegManageVo">
        /* Mypage.xml - selectSpecialDjReqManage */
        select
            idx
            , title
            , select_year
            , select_month
            , date_format(req_start_date, '%Y%m%d000000') req_start_date
            , date_format(req_end_date, '%Y%m%d235959') req_end_date
            , date_format(condition_start_date, '%Y.%m.%d') condition_start_date
            , date_format(condition_end_date, '%Y.%m.%d') condition_end_date
            , condition_code1
            , condition_data1
            , condition_code2
            , condition_data2
            , condition_code3
            , condition_data3
            , pc_image_url
            , mobile_image_url
            , is_view
            , platform
            , reg_date
            , op_name
            , last_upd_date
            , last_op_name
        from rd_admin.tb_req_special_dj_manage
        where select_year = #{select_year}
            and select_month = #{select_month}
    </select>

    <select id="selectMemberLevel" parameterType="java.lang.String" resultType="com.dalbit.admin.vo.MemberInfoVo">
        /* Mypage.xml - selectMemberLevel */
        select
            mem_no
            , `level`
            , grade
            , exp
            , last_upd_date
        from rd_data.tb_member_level
        where mem_no = #{mem_no}
    </select>

    <select id="selectMemberFanCnt" parameterType="java.lang.String" resultType="int">
        /* Mypage.xml - selectMemberFanCnt */
        select count(*)
        from rd_data.tb_member_fanstar
        where mem_no_star = #{mem_no}
    </select>

    <select id="selectListenerCnt" parameterType="java.lang.String" resultType="int">
        /* Mypage.xml - selectMemberLevel */
        select count(*)
        from rd_data.tb_member_broadcast_listening
        where dj_mem_no = #{mem_no}
            and DATE_FORMAT(concat(#{condition_start_date}, ' 00:00:00'), '%Y-%m-%d %H:%i:%s') <![CDATA[<=]]> start_date
            and start_date <![CDATA[<=]]> DATE_FORMAT(concat(#{condition_start_date}, ' 23:59:59'), '%Y-%m-%d %H:%i:%s')
    </select>

    <select id="memberShortCutAdd" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_shortcut_add(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>


    <select id="memberShortCutExtend" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_member_broadcast_shortcut_extend(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="msgClickUpdate" statementType="CALLABLE" parameterType="ProcedureVo" resultType="ProcedureVo">
        call sp_broadcast_msg_click_update(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})
    </select>

    <select id="selectAdminBadge" parameterType="String" resultType="int">
        SELECT
            *
        FROM (
            SELECT admin_badge FROM tb_member_profile WHERE mem_no = #{value}
            UNION ALL
            SELECT 0
        ) AS a
        ORDER BY admin_badge DESC
        LIMIT 1
    </select>
</mapper>